portbase=61076
MESSAGE starting agg and one collectors
JOBDATA $TESTDIR/job.data 1 2
DCFILE=$TESTDIR/run/fcn.conf
export DCFILE
export LDMSD_EXTRA="-P 8"
cat << EOF > $DCFILE
# fixme for ncsa schemes
meminfo MemFree RAW 1 MemFree 1 1 0
meminfo MemAvailable RAW 1 MemAvailable 1 1 0
meminfo Active RAW 1 Active 1 0 0
meminfo MemTotal RAW 1 MemTotal 1 0 0
meminfo mem_pct_active DIV_AB 2 Active,MemTotal 100 1 0

opa2 PortXmitData_rate RATE 1 PortXmitData 1 1 0
opa2 PortRcvData RATE 1 PortRcvData 1 1 0
opa2 PortXmitPkts RATE 1 PortXmitPkts 1 1 0
opa2 PortRcvPkts RATE 1 PortRcvPkts 1 1 0

#procnetdev rx_bytes#ens33  RAW 1 rx_bytes#ens33  1 0 0
procnetdev rx_bytes_rate#ens33 RATE 1 rx_bytes#ens33 1 1 0
#procnetdev tx_bytes#ens33  RAW 1 tx_bytes#ens33  1 0 0
procnetdev tx_bytes_rate#ens33 RATE 1 tx_bytes#ens33 1 1 0

Lustre_Client gscratch_read_bytes_rate RATE 1 client.lstats.read_bytes#llite.gscratch 1 1 0
Lustre_Client gscratch_write_bytes_rate RATE 1 client.lstats.write_bytes#llite.gscratch 1 0 0
Lustre_Client gscratch_open_rate RATE 1 client.lstats.open#llite.gscratch 1 1 0
Lustre_Client gscratch_close_rate RATE 1 client.lstats.close#llite.gscratch 1 1 0
Lustre_Client gscratch_seek_rate RATE 1 client.lstats.seek#llite.gscratch 1 1 0
Lustre_Client gscratch_getattr_rate RATE 1 client.lstats.getattr#llite.gscratch 1 1 0
Lustre_Client gscratch_create_rate RATE 1 client.lstats.create#llite.gscratch 1 1 0

Lustre_Client nscratch_read_bytes_rate RATE 1 client.lstats.read_bytes#llite.nscratch 1 1 0
Lustre_Client nscratch_write_bytes_rate RATE 1 client.lstats.write_bytes#llite.nscratch 1 0 0
Lustre_Client nscratch_open_rate RATE 1 client.lstats.open#llite.nscratch 1 1 0
Lustre_Client nscratch_close_rate RATE 1 client.lstats.close#llite.nscratch 1 1 0
Lustre_Client nscratch_seek_rate RATE 1 client.lstats.seek#llite.nscratch 1 1 0
Lustre_Client nscratch_getattr_rate RATE 1 client.lstats.getattr#llite.nscratch 1 1 0
Lustre_Client nscratch_create_rate RATE 1 client.lstats.create#llite.nscratch 1 1 0

procstat cores_up RAW 1 cores_up 1 0 0

#procstat user RAW 1 user 1 0 0
procstat user_rate RATE 1 user 1 0 0
procstat user_pct DIV_AB 2 user_rate,cores_up 100 1 0

#procstat nice RAW 1 nice 1 0 0
procstat nice_rate RATE 1 nice 1 0 0
procstat nice_pct DIV_AB 2 nice_rate,cores_up 100 1 0

#procstat sys RAW 1 sys 1 0 0
procstat sys_rate RATE 1 sys 1 0 0
procstat sys_pct DIV_AB 2 sys_rate,cores_up 100 1 0

#procstat idle RAW 1 idle 1 0 0
procstat idle_rate RATE 1 idle 1 0 0
procstat idle_pct DIV_AB 2 idle_rate,cores_up 100 1 0

#procstat iowait RAW 1 iowait 1 0 0
procstat iowait_rate RATE 1 iowait 1 0 0
procstat iowait_pct DIV_AB 2 iowait_rate,cores_up 100 1 0

procstat irq_rate RATE 1 irq 1 1 0
procstat context_switches_rate RATE 1 context_switches 1 1 0
procstat procs_running RAW 1 procs_running 1 1 0
procstat procs_blocked RAW 1 procs_blocked 1 1 0

loadavg load1min RAW 1 load1min 1 1
loadavg load5min RAW 1 load5min 1 1
loadavg load15min RAW 1 load15min 1 1

EOF

#vgon
#VGARGS="--track-origins=yes --leak-check=full --show-leak-kinds=all --trace-children=yes"
#VGARGS="--tool=drd --trace-mutex=yes "
LDMSD -p prolog.jobidinfo `seq 2`
#vgoff
LDMS_LS 1 -lv
LDMS_LS 2
SLEEP 11
KILL_LDMSD `seq 2`
MESSAGE logs and data under ${TESTDIR}
